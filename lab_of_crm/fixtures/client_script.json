[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Lead",
  "enabled": 1,
  "modified": "2025-04-09 16:23:28.168993",
  "module": "Lab Of Crm",
  "name": "Lead to deal button",
  "script": "frappe.ui.form.on('Lead', {\n    refresh: function(frm) {\n        if (!frm.is_new() && !frm.doc.custom_is_converted){\n            frm.add_custom_button(__('Convert to Deal'), function() {\n                frappe.confirm(\n                    'Are you sure you want to convert this Lead to a Deal?',\n                    () => {\n                        // Step 1: Mark Lead as Converted\n                        frappe.call({\n                            method: 'frappe.client.set_value',\n                            args: {\n                                doctype: 'Lead',\n                                name: frm.doc.name,\n                                fieldname: { custom_is_converted: 1 } // Set checkbox to checked\n                            },\n                            callback: function(response) {\n                                if (!response.exc) {\n                                    // Step 2: Create a new Deal\n                                    frappe.call({\n                                        method: 'frappe.client.insert',\n                                        args: {\n                                            doc: {\n                                                doctype: 'Deal',\n                                                lead: frm.doc.name,\n                                                deal_name: frm.doc.company_name || frm.doc.lead_name,\n                                                deal_owner: frappe.session.user,\n                                                name1: frm.doc.lead_name,\n                                                mobile_no: frm.doc.mobile_no,\n                                                product_group: frm.doc.custom_product_group,\n                                                product_name: frm.doc.custom_product_name,\n                                                description: frm.doc.custom_description\n                                            }\n                                        },\n                                        callback: function(r) {\n                                            if (r.message) {\n                                                frappe.show_alert({\n                                                    message: __('Deal created successfully'),\n                                                    indicator: 'green'\n                                                });\n                                                frappe.set_route('Form', 'Deal', r.message.name);\n                                            }\n                                        }\n                                    });\n                                }\n                            }\n                        });\n                    }\n                );\n            }).addClass('btn-primary');\n        }\n    }\n});",
  "view": "Form"
 }
]