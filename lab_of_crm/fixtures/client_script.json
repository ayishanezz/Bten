[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2025-08-13 18:00:06.632122",
  "module": "Lab Of Crm",
  "name": "Additional items table",
  "script": "frappe.ui.form.on(\"Quotation\", {\n    validate: function (frm) {\n        calculate_additional_items_totals(frm);\n    },\n\n    custom_additional_items_on_form_rendered(frm) {\n        trigger_server_recalc(frm);\n    }\n});\n\nfrappe.ui.form.on(\"Custom Additional Item\", {\n    qty: function (frm, cdt, cdn) {\n        update_additional_item_amount(frm, cdt, cdn);\n    },\n    rate: function (frm, cdt, cdn) {\n        update_additional_item_amount(frm, cdt, cdn);\n    },\n    custom_additional_items_remove: function (frm) {\n        calculate_additional_items_totals(frm);\n        trigger_server_recalc(frm);\n    }\n});\n\nfunction update_additional_item_amount(frm, cdt, cdn) {\n    const row = locals[cdt][cdn];\n    row.amount = (row.qty || 0) * (row.rate || 0);\n    frm.refresh_field(\"custom_additional_items\");\n    calculate_additional_items_totals(frm);\n    trigger_server_recalc(frm);\n}\n\nfunction calculate_additional_items_totals(frm) {\n    let total_amount = 0;\n    let total_qty = 0;\n\n    (frm.doc.custom_additional_items || []).forEach(item => {\n        item.amount = (item.qty || 0) * (item.rate || 0);\n        total_amount += item.amount;\n        total_qty += (item.qty || 0);\n    });\n\n    frm.set_value(\"custom_additional_total\", total_amount);\n    frm.set_value(\"custom_total_quantity\", total_qty);\n    frm.refresh_field(\"custom_additional_items\");\n}\n\nfunction trigger_server_recalc(frm) {\n    frappe.call({\n        method: \"lab_of_crm.api.quotation.recalculate_with_additional\",\n        doc: frm.doc,\n        callback: function (r) {\n            if (!r.exc && r.message) {\n                Object.assign(frm.doc, r.message);\n                frm.refresh_fields();\n            }\n        }\n    });\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2025-07-30 18:11:01.026468",
  "module": "Lab Of Crm",
  "name": "item change manually",
  "script": "frappe.ui.form.on(\"Quotation Item\", {\n    item_code: function(frm, cdt, cdn) {\n        let row = locals[cdt][cdn];\n        if (row.item_code) {\n            frappe.db.get_value(\"Item\", row.item_code, \"item_group\", function(r) {\n                if (r && r.item_group) {\n                    frappe.model.set_value(cdt, cdn, \"custom_items_group\", r.item_group);\n                }\n            });\n        }\n    }\n});\n",
  "view": "Form"
 }
]