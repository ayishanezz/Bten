[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2025-08-25 13:55:47.759000",
  "module": "Lab Of Crm",
  "name": "Additional items table",
  "script": "frappe.ui.form.on(\"Quotation\", {\n    validate: function (frm) {\n        calculate_additional_items_totals(frm);  // Always recalculate in UI\n    },\n\n    before_save: function (frm) {\n        const additional_total = frm.doc.custom_additional_total || 0;\n        const conversion_rate = frm.doc.conversion_rate || 1;\n\n        // Only update in UI for preview; real values handled in backend\n        frm.doc.net_total = (frm.doc.net_total || 0) + additional_total;\n        frm.doc.base_net_total = (frm.doc.base_net_total || 0) + (additional_total * conversion_rate);\n        frm.doc.grand_total = (frm.doc.grand_total || 0) + additional_total;\n        frm.doc.base_grand_total = (frm.doc.base_grand_total || 0) + (additional_total * conversion_rate);\n    }\n});\n\nfrappe.ui.form.on(\"Quotation Item\", {\n    qty: function (frm, cdt, cdn) {\n        update_additional_item_amount(frm, cdt, cdn);\n    },\n    rate: function (frm, cdt, cdn) {\n        update_additional_item_amount(frm, cdt, cdn);\n    },\n    custom_additional_items_remove: function (frm) {\n        calculate_additional_items_totals(frm);\n    }\n});\n\nfunction update_additional_item_amount(frm, cdt, cdn) {\n    const row = locals[cdt][cdn];\n\n    if (\n        frm.fields_dict.custom_additional_items &&\n        frm.fields_dict.custom_additional_items.grid.grid_rows_by_docname[cdn]\n    ) {\n        row.amount = (row.qty || 0) * (row.rate || 0);\n        frm.refresh_field(\"custom_additional_items\");\n        calculate_additional_items_totals(frm);\n    }\n}\n\nfunction calculate_additional_items_totals(frm) {\n    let total_amount = 0;\n    let total_qty = 0;\n\n    (frm.doc.custom_additional_items || []).forEach(item => {\n        item.amount = (item.qty || 0) * (item.rate || 0);\n        total_amount += item.amount;\n        total_qty += (item.qty || 0);\n    });\n\n    frm.set_value(\"custom_additional_total\", total_amount);\n    frm.set_value(\"custom_total_quantity\", total_qty);\n    frm.refresh_field(\"custom_additional_items\");\n}\n\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2025-08-25 13:56:04.114595",
  "module": "Lab Of Crm",
  "name": "item change manually",
  "script": "frappe.ui.form.on(\"Quotation Item\", {\n    item_code: function(frm, cdt, cdn) {\n        let row = locals[cdt][cdn];\n        if (row.item_code) {\n            frappe.db.get_value(\"Item\", row.item_code, \"item_group\", function(r) {\n                if (r && r.item_group) {\n                    frappe.model.set_value(cdt, cdn, \"custom_items_group\", r.item_group);\n                }\n            });\n        }\n    }\n});\n\n\n",
  "view": "Form"
 }
]