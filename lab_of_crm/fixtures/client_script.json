[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2025-07-23 12:39:19.041454",
  "module": "Lab Of Crm",
  "name": "Additional items table",
  "script": "frappe.ui.form.on(\"Quotation\", {\n    validate: function (frm) {\n        calculate_additional_items_totals(frm);  // still calculate early\n    },\n\n    before_save: function (frm) {\n        const custom_total = frm.doc.custom_additional_total || 0;\n        const conversion_rate = frm.doc.conversion_rate || 1;\n\n        // Add custom_additional_total to system totals\n        frm.doc.net_total += custom_total;\n        frm.doc.base_net_total += custom_total * conversion_rate;\n        frm.doc.grand_total += custom_total;\n        frm.doc.base_grand_total += custom_total * conversion_rate;\n    }\n});\n\nfrappe.ui.form.on(\"Quotation Item\", {\n    qty: function (frm, cdt, cdn) {\n        update_additional_item_amount(frm, cdt, cdn);\n    },\n    rate: function (frm, cdt, cdn) {\n        update_additional_item_amount(frm, cdt, cdn);\n    },\n});\n\n// Replace 'Your Custom Child Doctype' with the actual name of your child table DocType\nfrappe.ui.form.on(\"Your Custom Child Doctype\", {\n    custom_additional_items_remove: function (frm) {\n        calculate_additional_items_totals(frm);\n    }\n});\n\nfunction update_additional_item_amount(frm, cdt, cdn) {\n    const row = locals[cdt][cdn];\n\n    // Only run for rows inside custom_additional_items\n    if (frm.fields_dict.custom_additional_items.grid.grid_rows_by_docname[cdn]) {\n        row.amount = (row.qty || 0) * (row.rate || 0);\n        frm.refresh_field(\"custom_additional_items\");\n\n        calculate_additional_items_totals(frm);\n    }\n}\n\nfunction calculate_additional_items_totals(frm) {\n    let total_amount = 0;\n    let total_qty = 0;\n\n    (frm.doc.custom_additional_items || []).forEach(item => {\n        item.amount = (item.qty || 0) * (item.rate || 0);\n        total_amount += item.amount;\n        total_qty += item.qty || 0;\n    });\n\n    frm.set_value(\"custom_additional_total\", total_amount);\n    frm.set_value(\"custom_total_quantity\", total_qty);\n    frm.refresh_field(\"custom_additional_items\");\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Quotation",
  "enabled": 1,
  "modified": "2025-07-30 18:11:01.026468",
  "module": "Lab Of Crm",
  "name": "item change manually",
  "script": "frappe.ui.form.on(\"Quotation Item\", {\n    item_code: function(frm, cdt, cdn) {\n        let row = locals[cdt][cdn];\n        if (row.item_code) {\n            frappe.db.get_value(\"Item\", row.item_code, \"item_group\", function(r) {\n                if (r && r.item_group) {\n                    frappe.model.set_value(cdt, cdn, \"custom_items_group\", r.item_group);\n                }\n            });\n        }\n    }\n});\n",
  "view": "Form"
 }
]